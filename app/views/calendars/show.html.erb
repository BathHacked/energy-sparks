<h1>Calendar: <%= @calendar.title %></h1>

<% if @calendar.template? %>
  <p>This calendar is a template calendar, it currently has <%= School.enrolled.joins(:calendar).where('calendars.based_on_id = ?', @calendar.id).count %> dependent schools and <%= @calendar.calendars.count %> calendars which are dependent.</p>
<% end %>

<% if @calendar.schools.any? %>
  <h3>This calendar is allocated to the following enrolled schools:</h3>
  <ul>
    <% @calendar.schools.where(enrolled: true).each do |school| %>
      <li><%= link_to school.name, school_path(school) %></li>
    <% end %>
  </ul>
<% end %>
<% unless @calendar.based_on.nil? %>
  <p>And is based on: <%= link_to "#{@calendar.based_on.title} calendar", calendar_path(@calendar.based_on) %></p>
<% end %>
<p><%= link_to 'All Calendars', calendars_path %></p>

<h3>This calendar is editable</h3>
<p>You can amend the events, like the term times by clicking on them, updating the dates and saving the changes</p>

<div id="calendar" class="calendar"></div>

<%= render 'event_modal' %>

<% if School.enrolled.joins(:calendar).where('calendars.based_on_id = ?', @calendar.id).any? %>
  <h3>Dependent Schools</h3>
  <p>These schools all have their own calendar, based on this one.</p>
  <ul>
    <% School.enrolled.joins(:calendar).where('calendars.based_on_id = ?', @calendar.id).each do | school| %>
      <li><%= link_to school.name, calendar_path(school.calendar) %></li>
    <% end %>
  </ul>
<% end %>