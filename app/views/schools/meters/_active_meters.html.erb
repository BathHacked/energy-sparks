<% if active_meters.any? %>
  <% active_meters.each do |meter| %>
    <tr scope="row" class="<%='table-warning' if @invalid_mpan.include?(meter) %>">
      <td title="<%= (meter.meter_type.to_s.humanize) %>"><%= fa_icon(fuel_type_icon(meter.meter_type)) %></td>
      <td><%= meter.mpan_mprn %></td>
      <td><%= meter.name %></td>
      <td><%= meter.amr_data_feed_readings.count %></td>
      <td><%= meter.amr_validated_readings.count %></td>
      <td><%= nice_dates meter.last_validated_reading %></td>
      <td><%= link_to "CSV", school_meter_path(@school, meter, format: "csv") if meter.amr_validated_readings.any? %></td>
      <td>
        <div class="btn-group btn-group-sm" role="group">
        <%= link_to 'Details', school_meter_path(@school, meter), class: 'btn btn-sm btn-success' %>
          <% if can?(:report_on, meter) && meter.amr_validated_readings.any? %>
            <%= link_to 'Report', reports_amr_validated_reading_path(meter), class: 'btn btn-info btn-sm' %>
          <% end %>
        </div>
      </td>
      <td>
         <div class="btn-group btn-group-sm" role="group">
          <%= link_to 'Edit', edit_school_meter_path(@school, meter), class: 'btn btn-sm btn-warning' %>
          <%= link_to 'Deactivate', deactivate_school_meter_path(@school, meter), method: :put, class: 'btn btn-sm btn-secondary' %>
        </div>
      </td>
    </tr>
  <% end %>
<% else %>
  <tr>
    <td colspan="8">No active meters</td>
  </tr>
<% end %>
