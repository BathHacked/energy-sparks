<% content_for :page_title, "Activity Type: #{@activity_type.name}" %>

<div class="row padded-row">
  <div class="col-md-12">
    <h1><%= @activity_type.name %></h1>
    <h2><%= @school.name %></h2>
    <h3>
      <span class="badge badge-success" data-toggle="tooltip" data-placement="bottom" title="Score for this activity"><%= @activity_type.score %></span>
      <span class="badge badge-secondary" data-toggle="tooltip" data-placement="bottom" title="Category of activity"><%= @activity_type.activity_category.name %></span>
      <span class="badge badge-primary" data-toggle="tooltip" data-placement="bottom" title="Key Stages"><%= @activity_type.key_stage_list %></span>
    </h3>
  </div>
</div>

<% if @school.activities.includes(:activity_type).where(activity_type: @activity_type).any? %>
  <h5>Previous times this school has completed this activity</h5>
  <% @school.activities.includes(:activity_type).where(activity_type: @activity_type).order(:happened_on).each do |activity| %>
    <p>Completed at: <%= nice_dates activity.happened_on %> <%= link_to "View completed activity", school_activity_path(@school, activity), class: 'btn btn-sm' %> </p>
  <% end %>
  <hr/>
<% end %>

<div class="row">
  <div class="col-md-12 activity_type">
    <% if @activity_type.description %>
      <%= @activity_type.description %>
    <% else %>
      <p><em>No description given</em></p>
    <% end %>
  </div>
</div>

<% if @activity_type.active? && current_user && current_user.school %>
  <div class="row padded-row">
    <div class="col-md-12">
      <% if @recorded == 0 %>
        <h5> Be the first school to complete this activity!</h5>
        <p>This activity will score your school <strong><%= @activity_type.score %></strong> points!</p>
        <% if can?(:create, Activity) %>
          <%= link_to 'Record this activity', new_school_activity_path(current_user.school, activity_type_id: @activity_type.id), class: 'btn btn-primary' %>
        <% end %>
      <% else %>
        <h5>Complete this activity at your school</h5>
        <p>This activity will score your school <strong><%= @activity_type.score %></strong> points!</p>
        <p><strong><%= pluralize(@school_count, 'school has', 'schools have') %> scored points for this activity </strong>.</p>
        <% if can?(:create, Activity) %>
          <%= link_to 'Record this activity', new_school_activity_path(current_user.school, activity_type_id: @activity_type.id), class: 'btn btn-primary' %>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>

<p><%= link_to 'View all activities', activity_categories_path, class: 'btn btn-secondary' %></p>

