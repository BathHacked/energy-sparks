<h1>All tariffs</h1>

<h2>Electricity</h2>

<div>
  <%= link_to 'Add electricity tariff', choose_meters_school_user_tariffs_path(@school, fuel_type: :electricity), class: 'btn btn-success' %>
</div>

<br/>
<br/>

<% @user_tariffs.select{|tariff| tariff.electricity?}.each_with_index do |user_tariff, idx| %>
  <div id="accordion<%= idx %>" class="accordion-block">
    <div class="card">
      <div class="card-header" id="heading<%= idx %>">
        <h5 class="mb-0">
          <a class="nav-link collapsed" data-toggle="collapse" data-target="#collapse<%= idx %>" href="#collapse<%= idx %>" role="button" aria-expanded="false" aria-controls="multiCollapseExample1">
            <%= render 'title', user_tariff: user_tariff %>
          </a>
        </h5>
      </div>
      <div id="collapse<%= idx %>" class="collapse" aria-labelledby="heading<%= idx %>" data-parent="#accordion<%= idx %>">
        <div class="card-body">
          <div class="padded-row">
            <%= render 'schools/user_tariffs/rates_table', school: @school, user_tariff: user_tariff, allow_edits: false %>
            <br/>
            <%= render 'schools/user_tariffs/charges_table', school: @school, user_tariff: user_tariff, allow_edits: false %>
          </div>
          <%# if user_tariff.meters.present? %>
            <div class="padded-row">
              <p>The following meters are associated with this tariff:</p>
              <ul>
                <% user_tariff.meters.each do |meter| %>
                  <li><%= meter.mpan_mprn %></li>
                <% end %>
              </ul>
            </div>
          <%# end %>
          <div class="padded-row">
            <%= link_to "Edit", edit_school_user_tariff_path(@school, user_tariff), class: 'btn' %>
            <%= link_to "Delete", school_user_tariff_path(@school, user_tariff), method: :delete, data: {confirm: 'Are you sure?'}, class: 'btn btn-danger' %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

