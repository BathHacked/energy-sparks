<% content_for :page_title do %>
    <%= @school.name %>
<% end %>

<div typeof="School">
  <div class="row padded-row">
    <div class="col-md-12">
      <%- if can? :manage, @school -%>
        <div class="float-right">
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="manage-school" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Manage school
            </button>
            <div class="dropdown-menu" aria-labelledby="manage-school">
              <%= link_to 'Edit school details', edit_school_path(@school), class: 'dropdown-item' %>
              <%= link_to 'Energy configuration', edit_school_configuration_path(@school), class: 'dropdown-item'%>
              <%= link_to 'Manage alerts', school_alerts_path(@school), class: 'dropdown-item'%>
              <%= link_to 'Manage groups', edit_school_school_group_path(@school), class: 'dropdown-item'%>
              <%= link_to 'Manage meters', school_meters_path(@school), class: 'dropdown-item' %>
              <%= link_to 'Manage school times', edit_school_times_path(@school), class: 'dropdown-item'%>
            </div>
          </div>
        </div>
      <%- end -%>

      <h1 property="name"><%= @school.name %></h1>
      <h6 class="large">
        <address property="address" typeof="PostalAddress">
          <span property="streetAddress"><%= @school.address %></span>, <span property="postalCode"><%= @school.postcode %></span>
        </address>
        |
        <%= link_to('Visit school website',
                    @school.website,
                    target: :new,
                    property: "url") unless @school.website.blank? %>

      </h6>
      <p>
        <%- if can? :manage, @school -%>
          Record your energy saving activities, check your scores and latest awards, and explore your energy usage data.
        <% else %>
          This school is using <%= t('application') %> to become more energy efficient. Explore their energy saving activities,
          see their scores and awards, and explore their energy usage data.
        <%- end -%>
      </p>
      <p class="float-right">
        <%= link_to 'Analysis', school_analysis_path(@school), class: 'btn btn-success btn-sm' %>
        <%= link_to 'Simulations', school_simulations_path(@school), class: 'btn btn-success btn-sm' %>
        <%= link_to('Calendar', calendar_path(@school.calendar), class: 'btn btn-primary btn-sm') if can? :manage, @school.calendar %>
        <%= link_to 'Alert reports', school_alert_reports_path(@school), class: 'btn btn-primary btn-sm'%>
    </div>
  </div>
  <div class="row">

    <div class="col-md-12">
      <%= render partial: 'schools/activity_cards' %>
      <%= render 'schools/meter_cards', meter_type: :electricity, school: @school if @school.meters?(:electricity) %>
      <% if @school.meters?(:gas) %>
        <%= render 'schools/meter_cards', meter_type: :gas, school: @school %>
      <% else %>
        <section id="gas-cards">
          <h4>This school has no gas meters configured in Energy Sparks</h4>
        </section>
      <% end %>
    </div>
  </div>
</div>
