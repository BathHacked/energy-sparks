<% content_for :page_title, 'AMR report' %>

<h1>AMR Data report for active meters</h1>
<p><%= link_to 'Reports index', reports_path, class: 'btn btn-success' %></p>
<p><%= link_to "Download all AMR data", reports_amr_validated_readings_path(format: :csv) %></p>

<h3>Loader Legend</h3>
<div class='calendar-legend row'>
  <div class='legend-scale'>
    <ul class='legend-labels'>
      <li><span style='background:rgb(244,183,191);'></span>No reading for 30 days</li>
      <li><span style='background:rgb(255,237,169);'></span>No reading for 5 days</li>
      <li><span style='background:#5cb85c;'></span>Recent reading</li>
    </ul>
  </div>
</div>

<div class="row">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>School</th>
        <th>Amr Readings</th>
        <th>Supply</th>
        <th>First validated reading</th>
        <th>Last validated reading</th>
      </tr>
    </thead>
    <tbody>
      <% @meters.each do |meter| %>
        <tr>
          <td><%= link_to(meter.school.name, school_path(meter.school)) %></td>
          <td><%= link_to(meter.display_name, reports_amr_validated_reading_path(meter)) if AmrValidatedReading.where(meter_id: meter.id).any? %></td>
          <td><%= meter.meter_type.capitalize %></td>
          <td><%= nice_dates(meter.first_validated_reading) %></td>
          <td class=<%= class_for_last_date(meter.last_validated_reading) %>><%= nice_dates(meter.last_validated_reading) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

