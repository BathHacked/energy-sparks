<h1>Preview uploaded data</h1>
<h2>From file: <%= @amr_uploaded_reading.file_name %></h2>

<p>Configuration: <%= @amr_uploaded_reading.amr_data_feed_config.description %></p>

<% if @warnings.any? %>
  <h3>First ten warnings</h3>
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Warning message</th>
          <th>Mpan Mprn</th>
          <th>Reading Date</th>
          <th colspan="48">Readings</th>
        </tr>
      </thead>
      <tbody>
        <% @warnings.first(10).each do |row| %>
          <tr>
            <td><%= AmrReadingData::WARNINGS[row["warning"].to_sym] %></td>
            <td><%= row["mpan_mprn"] %></td>
            <td><%= row["reading_date"] %></td>
            <% row["readings"].each do |reading| %>
              <td><%= reading %></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <p>Note: There were no warnings for this file</p>
<% end %>

<h3>(Up to) First ten rows</h3>
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Meter ID</th>
        <th>Mpan Mprn</th>
        <th>Reading Date</th>
        <th colspan="48">Readings</th>
      </tr>
    </thead>
    <tbody>
      <% @valid_reading_data.first(10).each do |row| %>
        <tr>
          <td><%= row["meter_id"] %></td>
          <td><%= row["mpan_mprn"] %></td>
          <td><%= nice_dates Date.parse(row["reading_date"]) %></td>
          <% row["readings"].each do |reading| %>
            <td><%= reading %></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<%= form_with(url: admin_create_amr_data_feed_readings_path(@amr_uploaded_reading), method: :post, local: true) do %>
  <%= submit_tag "I'm happy, insert this data", class: 'btn', data: { disable_with: false } %>
<% end %>

<p><%= link_to 'Back', new_admin_amr_data_feed_config_amr_uploaded_reading_path(@amr_data_feed_config) %></p>
<p><%= link_to 'Back to AMR Data Feed Configurations', admin_amr_data_feed_configs_path %></p>
